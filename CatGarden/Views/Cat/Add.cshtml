@model CatGarden.Web.ViewModels.Cat.CatFormModel
@using static CatGarden.Common.Enums
@using CatGarden.Web.Infrastructure.Extensions

@{
    ViewData["Title"] = "Add Cat";
}
<style>
    .dz-set-default {
        position: absolute;
        top: 30px;
        right: -4px;
        z-index: 20;
        width: 22px;
        height: 22px;
        background-color: #39bbb0;
        color: #ffffff;
        border-radius: 50%;
        font-size: 14px;
        text-align: center;
        display: block;
        cursor: pointer;
    }

        .dz-set-default.active {
            background-color: #32c787;
        }

        .dz-set-default:focus {
            background-color: #32c787;
            color: #ffffff;
        }

        .dz-set-default:hover {
            cursor: pointer;
        }
</style>



<div style="display: flex; justify-content: center; align-items: center;">
    <div style="max-width: 600px; width: 100%;">
        <h2 class="text-center">@ViewData["Title"]</h2>

        <form asp-action="Add" method="post" enctype="multipart/form-data" class="dropzone" id="myDropzone">
            <div class="form-group">
                <label asp-for="Name"></label>
                <input asp-for="Name" class="form-control" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Age"></label>
                <input asp-for="Age" class="form-control" />
                <span asp-validation-for="Age" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Gender"></label>
                <select asp-for="Gender" class="form-control">
                    <option value="">Select Gender</option>
                    @foreach (var gender in Enum.GetValues(typeof(Gender)))
                    {
                        <option value="@gender">@gender</option>
                    }
                </select>
                <span asp-validation-for="Gender" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Breed"></label>
                <select asp-for="Breed" class="form-control">
                    <option value="">Select Breed</option>
                    @foreach (Breed breed in Enum.GetValues(typeof(Breed)))
                    {
                        <option value="@breed.ToString()">@EnumExtensions.GetDisplayName(breed)</option>
                    }
                </select>
                <span asp-validation-for="Breed" class="text-danger"></span>
            </div>



            <div class="form-group">
                <label asp-for="Color"></label>
                <select asp-for="Color" class="form-control">
                    <option value="">Select Color</option>
                    @foreach (var color in Enum.GetValues(typeof(Color)))
                    {
                        <option value="@color">@color</option>
                    }
                </select>
                <span asp-validation-for="Color" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="CoatLength"></label>
                <select asp-for="CoatLength" class="form-control">
                    <option value="">Select Coat Length</option>
                    @foreach (var coatLength in Enum.GetValues(typeof(CoatLength)))
                    {
                        <option value="@coatLength">@coatLength</option>
                    }
                </select>
                <span asp-validation-for="CoatLength" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Description"></label>
                <textarea asp-for="Description" class="form-control"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            
            <div class="fallback">
                <input type="file" name="file" multiple />
            </div>


            <div class="form-group">
                <label asp-for="SelectedCatteryId"></label>
                <select asp-for="SelectedCatteryId" class="form-control">
                    <option value="">Select Cattery</option>
                    @foreach (var cattery in Model.Catteries)
                    {
                        <option value="@cattery.Id">@cattery.Name</option>
                    }
                </select>
                <span asp-validation-for="SelectedCatteryId" class="text-danger"></span>
            </div>




            <button type="submit" class="btn btn-primary">Add Cat</button>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <!-- Include Dropzone.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/min/dropzone.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/min/dropzone.min.js"></script>

    <script>
        $(document).ready(function () {
            let myDropzone = new Dropzone("#myDropzone", { 
                addRemoveLinks: true,
                dictRemoveFile: "",
                url: "/api/upload",
                previewTemplate: `<div class="dz-preview dz-complete dz-image-preview">
                            <div class="dz-image">
                              <img data-dz-thumbnail>
                            </div>
                            <div class="dz-details">
                              <div class="dz-size" data-dz-size></div>
                              <div class="dz-filename">
                                <span data-dz-name></span>
                              </div>
                            </div>
                            <div class="dz-progress">
                              <span class="dz-upload" data-dz-uploadprogress></span>
                            </div>
                            <div class="dz-error-message">
                              <span data-dz-errormessage></span>
                            </div>
                            <div class="dz-success-mark">
                              <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                                <!-- Your SVG code for success mark -->
                              </svg>
                            </div>
                            <div class="dz-error-mark">
                              <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                                <!-- Your SVG code for error mark -->
                              </svg>
                            </div>
                            <a class="dz-remove" href="javascript:undefined;" data-dz-remove></a>
                            <a class="dz-set-default" href="javascript:undefined;">
                              <i class="zmdi zmdi-star-outline"></i>
                            </a>
                          </div>`,
                removedfile: function (file) {
                    var _ref;
                    if (file.previewElement) {
                        if ((_ref = file.previewElement) != null) {
                            _ref.parentNode.removeChild(file.previewElement);
                        }
                    }

                    return this._updateMaxFilesReachedClass();
                }
            });

            let images = @Html.Raw(Json.Serialize(Model.Images));
            images.map(img => {
                let cloneImg = Object.assign({}, img);
                cloneImg.name = cloneImg.alt;
                cloneImg.id = img.id;
                cloneImg.is_default = img.is_default;
                cloneImg.path = "/" + cloneImg.path;
                myDropzone.emit("addedfile", cloneImg);
                myDropzone.emit("thumbnail", cloneImg, cloneImg.path);
                myDropzone.emit("complete", cloneImg);
                myDropzone.files.push(cloneImg);
                let file = myDropzone.files.find(f => f.id == img.id);
                $(file.previewTemplate).attr("data-id", img.id);
                if (cloneImg.is_default) {
                    $(file.previewTemplate)
                        .find(".dz-set-default")
                        .addClass("active");
                    $(file.previewTemplate)
                        .find(".dz-set-default i")
                        .removeClass("zmdi-star-outline")
                        .addClass("zmdi-star");
                }
            });
            myDropzone.on("complete", file => {
                product.form.images.push(JSON.parse(file.xhr.response));
                file.id = JSON.parse(file.xhr.response).id;
                $(file.previewTemplate)
                    .find(".dz-preview")
                    .attr("data-id", file.id); 
            });
        });
    </script>
}

